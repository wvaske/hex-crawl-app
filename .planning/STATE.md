# Project State

## Project Reference

See: .planning/PROJECT.md (updated 2026-01-26)

**Core value:** Real-time hex crawl exploration with fog of war -- the DM controls what players see, and when hexes are revealed, every connected player sees it instantly.
**Current focus:** Phase 2 complete. Ready for Phase 3 - Real-Time Infrastructure

## Current Position

Phase: 2 of 8 (Server & Authentication) - COMPLETE
Plan: 4 of 4 in current phase
Status: Complete
Last activity: 2026-01-27 - Phase 2 verified and complete

Progress: [████████░░] ~32% (8 of ~25 total plans)

## Performance Metrics

**Velocity:**
- Total plans completed: 8
- Average duration: 7min
- Total execution time: 59min

**By Phase:**

| Phase | Plans | Total | Avg/Plan |
|-------|-------|-------|----------|
| 01-hex-grid-foundation | 4/4 | 33min | 8min |
| 02-server-authentication | 4/4 | 26min | 7min |

**Recent Trend:**
- Last 5 plans: 9min, 5min, 4min, 5min, 12min
- Trend: consistent

*Updated after each plan completion*

## Accumulated Context

### Decisions

Decisions are logged in PROJECT.md Key Decisions table.
Recent decisions affecting current work:

- [Roadmap]: Multi-scale zoom (ZOOM-01/02/03), encounter tables (ENC-01/02), terrain painting (PAINT-01), and travel/weather mechanics deferred to v2
- [Roadmap]: Phase 6 (Map Image Upload) depends only on Phase 1, enabling parallel execution with Phases 2-5
- [01-01]: Flat-top hex orientation (Orientation.FLAT) following D&D convention
- [01-01]: 40px circumradius default for hex size
- [01-01]: topLeft origin + offset -1 for PixiJS sprite alignment
- [01-01]: JSON format for map import/export (no YAML dependency)
- [01-01]: Tailwind CSS v4 via @tailwindcss/vite plugin (CSS-first config)
- [01-01]: Zustand stores use new Map/Set instances for reactivity
- [01-02]: Sprite-based rendering with pre-generated textures for 60 FPS at 500+ hexes
- [01-02]: Offscreen Canvas 2D for runtime texture generation (no external asset pipeline)
- [01-02]: pixi-viewport registered as custom JSX component via extend({ Viewport })
- [01-02]: Imperative Graphics management for grid lines (avoiding @pixi/react draw callback limitation)
- [01-02]: Viewport culling via AABB bounds check per tick with threshold-based recalculation
- [01-02]: Seeded PRNG (mulberry32) for deterministic terrain noise patterns per variant
- [01-03]: Seed-and-grow BFS with ~15% seed rate, distance-decay growth (70/50/30/15%)
- [01-03]: Post-processing pass ensures water-coast adjacency after BFS
- [01-03]: 6 primary terrain seeds; coast generated by adjacency rules
- [01-03]: SidePanel tabs: Info, Terrain, Create, Import/Export
- [01-03]: Tailwind dark theme: bg-gray-800/700 panels, bg-gray-900 main, text-gray-100/200/300
- [01-04]: Module-level viewport ref (ViewportContext.tsx) for cross-component access (PixiJS reconciler doesn't support React context)
- [01-04]: HTML canvas addEventListener for pointer events with viewport.toWorld coordinate conversion
- [01-04]: Shift+drag area selection with viewport drag plugin pause/resume
- [01-04]: Graphics for dynamic highlight overlays, Sprites for static terrain tiles
- [01-04]: 5px click-vs-drag threshold to prevent accidental selection during pan
- [02-01]: Manual Better Auth schema (CLI incompatible with ESM barrel .js imports via jiti CJS resolver)
- [02-01]: drizzle.config.ts uses explicit schema file array (not barrel index.ts) for same CJS/ESM reason
- [02-02]: Extensionless imports in schema files (./auth not ./auth.js) for drizzle-kit CJS resolver compatibility
- [02-02]: AppVariables type exported from app.ts for route-level type safety
- [02-02]: Campaign creation + DM member insert wrapped in db.transaction() for atomicity
- [02-03]: AuthGuard uses state toggle (useState) for login/signup switching, not React Router
- [02-03]: Logout button as fixed top-right overlay to avoid modifying MapView component
- [02-03]: Forgot password link is placeholder alert (email infrastructure not yet configured)
- [02-03]: Inline error display maps error message keywords to specific form fields
- [02-04]: Vite proxy with origin rewrite replaces direct cross-origin CORS for dev
- [02-04]: Invitations router mounted at /api with full paths inside (no conflict with /api/campaigns)
- [02-04]: View-state navigation with useState enum (campaigns|dashboard|map) instead of router library

### Pending Todos

None yet.

### Blockers/Concerns

None yet.

## Session Continuity

Last session: 2026-01-27T18:30:00Z
Stopped at: Phase 2 complete. Ready for Phase 3.
Resume file: None
